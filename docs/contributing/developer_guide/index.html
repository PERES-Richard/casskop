<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.17">
<link rel="alternate" type="application/rss+xml" href="/casskop/blog/rss.xml" title="CassKop RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/casskop/blog/atom.xml" title="CassKop Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="CassKop" href="/casskop/opensearch.xml"><title data-rh="true">Developer guide | CassKop</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://cscetbon.github.io/casskop/docs/contributing/developer_guide"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Developer guide | CassKop"><meta data-rh="true" name="description" content="Operator SDK"><meta data-rh="true" property="og:description" content="Operator SDK"><link data-rh="true" rel="icon" href="/casskop/img/casskop.ico"><link data-rh="true" rel="canonical" href="https://cscetbon.github.io/casskop/docs/contributing/developer_guide"><link data-rh="true" rel="alternate" href="https://cscetbon.github.io/casskop/docs/contributing/developer_guide" hreflang="en"><link data-rh="true" rel="alternate" href="https://cscetbon.github.io/casskop/docs/contributing/developer_guide" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://HI64OQWYI7-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/casskop/assets/css/styles.9c09b91e.css">
<link rel="preload" href="/casskop/assets/js/runtime~main.a5dc286a.js" as="script">
<link rel="preload" href="/casskop/assets/js/main.70a062b2.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/casskop/"><div class="navbar__logo"><img src="/casskop/img/casskop_alone.png" alt="CassKop Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/casskop/img/casskop_alone.png" alt="CassKop Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">CassKop</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/casskop/docs/concepts/introduction">Docs</a><a class="navbar__item navbar__link" href="/casskop/blog">Blog</a><a href="https://github.com/cscetbon/casskop" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_S7eR toggle_TdHA toggleDisabled_f9M3"><div class="toggleButton_rCf9" role="button" tabindex="-1"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></div><input type="checkbox" class="toggleScreenReader_g2nN" aria-label="Switch between dark and light mode (currently light mode)"></div><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/casskop/docs/concepts/introduction">Concepts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/casskop/docs/setup/getting_started">Setup</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/casskop/docs/configuration_deployment/customizable_install_with_helm">Advanced Configuration</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/casskop/docs/operations/implementation_architecture">Operations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/casskop/docs/references/cassandra_cluster">Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/casskop/docs/troubleshooting/operations_issues">Troubleshooting</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/casskop/docs/contributing/developer_guide">Contributing</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/casskop/docs/contributing/developer_guide">Developer guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/casskop/docs/contributing/release_guide">Release guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/casskop/docs/contributing/reporting_bugs">Reporting bugs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/casskop/docs/contributing/credits">Credits</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/casskop/">🏠</a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link breadcrumbsItemLink_e5ie">Contributing</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/casskop/docs/contributing/developer_guide">Developer guide</a></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Developer guide</h1></header><h2 class="anchor anchorWithStickyNavbar_mojV" id="operator-sdk">Operator SDK<a class="hash-link" href="#operator-sdk" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="prerequisites">Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">​</a></h3><p>Casskop has been validated with :</p><ul><li><a href="https://golang.github.io/dep/" target="_blank" rel="noopener noreferrer">dep</a> version v0.5.1+.</li><li><a href="https://golang.org" target="_blank" rel="noopener noreferrer">go</a> version v1.13+.</li><li><a href="https://www.docker.com" target="_blank" rel="noopener noreferrer">docker</a> version 18.09+.</li><li><a href="https://kubernetes.io/fr/docs/tasks/tools/install-kubectl/" target="_blank" rel="noopener noreferrer">kubectl</a> version v1.13.3+.</li><li><a href="https://helm.sh/" target="_blank" rel="noopener noreferrer">Helm</a> version v.3.</li><li>Fork from <a href="https://github.com/operator-framework/operator-sdk" target="_blank" rel="noopener noreferrer">Operator sdk</a> version v0.18.0 : <a href="https://github.com/erdrix/operator-sdk/tree/v0.18.0-forked-pr317" target="_blank" rel="noopener noreferrer">Operator sdk - forked</a></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="install-the-operator-sdk-cli">Install the Operator SDK CLI<a class="hash-link" href="#install-the-operator-sdk-cli" title="Direct link to heading">​</a></h3><p>First, checkout and install the operator-sdk CLI:</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ mkdir -p $GOPATH/src/github.com/operator-framework/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ cd $GOPATH/src/github.com/operator-framework/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">git clone -b v0.18.0-forked-pr317 --single-branch git@github.com:erdrix/operator-sdk.git</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ make tidy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ make install</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><strong>Note :</strong> Use fork from operator-sdk, waiting for <a href="https://github.com/kubernetes-sigs/controller-tools/pull/317/files#diff-8963ad7c8dcbe3931bc61c3e2954ccf2R300-R301" target="_blank" rel="noopener noreferrer">PR #317</a> to be merged.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="initial-setup">Initial setup<a class="hash-link" href="#initial-setup" title="Direct link to heading">​</a></h3><p>Checkout the project.</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ git clone https://github.com/cscetbon/casskop.git</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ cd casskop</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="local-kubernetes-setup">Local kubernetes setup<a class="hash-link" href="#local-kubernetes-setup" title="Direct link to heading">​</a></h3><p>We use <a href="https://kind.sigs.k8s.io" target="_blank" rel="noopener noreferrer">kind</a> in order to run a local kubernetes cluster with the version we chose. We think it deserves some words as it&#x27;s pretty useful and simple to use to test one version or another</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="install">Install<a class="hash-link" href="#install" title="Direct link to heading">​</a></h4><p>The following requires kubens to be present. On MacOs it can be installed using brew :</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">brew install kubectx</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The installation of kind is then done with (outside of the cassandra operator folder if you want it to run fast) :</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ GO111MODULE=&quot;on&quot; go get sigs.k8s.io/kind@v0.5.1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="setup">Setup<a class="hash-link" href="#setup" title="Direct link to heading">​</a></h4><p>The following actions should be run only to create a new kubernetes cluster.</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ config/samples/kind/create-kind-cluster.sh</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>or if you want to enable network policies</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ config/samples/kind/create-kind-cluster-network-policies.sh</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>It creates namespace cassandra-e2e by default. If a different namespace is needed it can be specified on the setup-requirements call</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ config/samples/kind/setup-requirements.sh other-namespace</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>To interact with the cluster you then need to use the generated kubeconfig file :</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ export KUBECONFIG=$(kind get kubeconfig-path --name=kind)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Before using that newly created cluster, it&#x27;s better to wait for all pods to be running by continously checking their status :</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl get pod --all-namespaces -w</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="pauseunpause-the-cluster">Pause/Unpause the cluster<a class="hash-link" href="#pauseunpause-the-cluster" title="Direct link to heading">​</a></h4><p>In order to kinda freeze the cluster because you need to do something else on your laptop, you can use those two aliases. Just put them in your ~/.bashrc or ~/.zshrc :</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">alias kpause=&#x27;kind get nodes|xargs docker pause&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">alias kunpause=&#x27;kind get nodes|xargs docker unpause&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="delete-cluster">Delete cluster<a class="hash-link" href="#delete-cluster" title="Direct link to heading">​</a></h4><p>The simple command <code>kind delete cluster</code> takes care of it.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="build-casskop">Build CassKop<a class="hash-link" href="#build-casskop" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_mojV" id="using-your-local-environment">Using your local environment<a class="hash-link" href="#using-your-local-environment" title="Direct link to heading">​</a></h4><p>If you prefer working directly with your local go environment you can simply uses :</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">make get-deps</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">make build</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><blockquote><p>You can check on the Gitlab Pipeline to see how the Project is build and test for each push</p></blockquote><h4 class="anchor anchorWithStickyNavbar_mojV" id="or-using-the-provided-cross-platform-build-environment">Or Using the provided cross platform build environment<a class="hash-link" href="#or-using-the-provided-cross-platform-build-environment" title="Direct link to heading">​</a></h4><p>Build the docker image which will be used to build CassKop docker image</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">make build-ci-image</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><blockquote><p>If you want to change the operator-sdk version change the <strong>OPERATOR_SDK_VERSION</strong> in the Makefile.</p></blockquote><p>Then build CassKop (code &amp; image)</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">make docker-get-deps</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">make docker-build</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="run-casskop">Run CassKop<a class="hash-link" href="#run-casskop" title="Direct link to heading">​</a></h3><p>We can quickly run CassKop in development mode (on your local host), then it will use your kubectl configuration file to connect to your kubernetes cluster.</p><p>There are several ways to execute your operator :</p><ul><li>Using your IDE directly</li><li>Executing directly the Go binary</li><li>deploying using the Helm charts</li></ul><p>If you want to configure your development IDE, you need to give it environment variables so that it will uses to connect to kubernetes.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">KUBECONFIG=&lt;path/to/your/kubeconfig&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">WATCH_NAMESPACE=&lt;namespace_to_watch&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">POD_NAME=&lt;name for operator pod&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">LOG_LEVEL=Debug</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">OPERATOR_NAME=ide</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="run-the-operator-locally-with-the-go-binary">Run the Operator Locally with the Go Binary<a class="hash-link" href="#run-the-operator-locally-with-the-go-binary" title="Direct link to heading">​</a></h4><p>This method can be used to run the operator locally outside of the cluster. This method may be preferred during development as it facilitates faster deployment and testing.</p><p>Set the name of the operator in an environment variable</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ export OPERATOR_NAME=casskop</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Deploy the CRD</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl apply -f config/crd/bases/db.orange.com_cassandraclusters.yaml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ make run</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This will run the operator in the <code>default</code> namespace using the default Kubernetes config file at <code>$HOME/.kube/config</code>.</p><p><strong>Note:</strong> JMX operations cannot be executed on Cassandra nodes when running the operator locally. This is because the operator makes JMX calls over HTTP using jolokia and when running locally the operator is on a different network than the Cassandra cluster.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="deploy-using-the-helm-charts">Deploy using the Helm Charts<a class="hash-link" href="#deploy-using-the-helm-charts" title="Direct link to heading">​</a></h4><p>This section provides an instructions for running the operator Helm charts with an image that is built from the local branch.</p><p>Build the image from the current branch.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ export DOCKER_REPO_BASE=&lt;your-docker-repo&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ make docker-build</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Push the image to docker hub (or to whichever repo you want to use)</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ make push</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><strong>Note:</strong> In this example we are pushing to docker hub.</p><p><strong>Note:</strong> The image tag is a combination of the version as defined in <code>verion/version.go</code> and the branch name.</p><p>Install the Helm chart.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ helm install ./charts/casskop \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --set-string image.repository=ghcr.io/cscetbon/casskop,image.tag=0.4.0-local-dev-helm \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --name local-dev-helm</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><strong>Note:</strong> The <code>image.repository</code> and <code>image.tag</code> template variables have to match the names from the image that we pushed in the previous step.</p><p><strong>Note:</strong> We set the chart name to the branch, but it can be anything.</p><p>Lastly, verify that the operator is running.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl get pods</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NAME                                                READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">local-dev-helm-casskop-8946b89dc-4cfs9   1/1     Running   0          7m45s</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="run-unit-tests">Run unit-tests<a class="hash-link" href="#run-unit-tests" title="Direct link to heading">​</a></h3><p>You can run Unit-test for CassKop</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">make unit-test</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="run-e2e-end-to-end-tests">Run e2e end to end tests<a class="hash-link" href="#run-e2e-end-to-end-tests" title="Direct link to heading">​</a></h3><p>CassKop also have several end-to-end tests that can be run using makefile.</p><p>You need to create the namespace <code>cassandra-e2e</code> before running the tests.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl create namespace cassandra-e2e</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>to launch different tests in parallel in different temporary namespaces</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">make e2e</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>or sequentially in the namespace <code>cassandra-e2e</code></p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">make e2e-test-fix</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><strong>Note</strong>: <code>make e2e</code> executes all tests in different, temporary namespaces in parallel. Your k8s cluster will need a lot of resources to handle the many Cassandra nodes that launch in parallel. </p><p><strong>Note</strong>: <code>make e2e-test-fix</code> executes all tests serially in the <code>cassandra-e2e</code> namespace and as such does not require as many k8s resources as <code>make e2e</code> does, but overall execution will be slower.</p><p>You can choose to run only 1 test using the args ex:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">make e2e-test-fix-arg ClusterScaleDown</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><strong>Tip</strong>: When debugging test failures, you can run <code>kubectl get events --all-namespaces</code> which produce output like:</p><p><code>cassandracluster-group-clusterscaledown-1561640024   0s    Warning   FailedScheduling   Pod   0/4 nodes are available: 1 node(s) had taints that the pod didn&#x27;t tolerate, 3 Insufficient cpu.</code></p><p><strong>Tip</strong>: When tests fail, there may be resources that need to be cleaned up. Run <code>tools/e2e_test_cleanup.sh</code> to delete resources left over from tests.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="run-kuttl-tests">Run kuttl tests<a class="hash-link" href="#run-kuttl-tests" title="Direct link to heading">​</a></h3><p>This requires <a href="https://kuttl.dev/docs/cli.html#setup-the-kuttl-kubectl-plugin" target="_blank" rel="noopener noreferrer">kuttl cli</a> to be installed on your machine</p><p>You first need to have a Kubernetes cluster set up with kubectl.</p><p>Then to run all tests you can simply type :</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl kuttl test --config ./test/e2e/kuttl/kuttl-test.yaml ./test/e2e/kuttl/</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This will run all testcases in the <code>/test/e2e/kuttl/</code> directory in parallel on different generated namespaces (with Casskop automatically installed on each).</p><blockquote><p>If you installed only the binary of kuttl, you can omit the <code>kubectl</code> at the beginning</p></blockquote><p><strong>Tip</strong>: You can specify a single test case to run by adding <code>--test TestCase</code> where <code>TestCase</code> is the name of one of the directories in <code>/test/e2e/kuttl/*here*</code> (like <code>ScaleUpAndDown</code> for example)</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="debug-casskop-in-remote-in-a-kubernetes-cluster">Debug CassKop in remote in a Kubernetes cluster<a class="hash-link" href="#debug-casskop-in-remote-in-a-kubernetes-cluster" title="Direct link to heading">​</a></h3><p>CassKop makes some specific calls to the Jolokia API of the CassandraNodes it deploys inside the kubernetes
cluster. Because of this, it is not possible to fully debug CassKop when launch outside the kubernetes cluster (in
your local IDE).</p><p>It is possible to use external solutions such as KubeSquash or Telepresence.</p><p>Telepresence launch a bi-directional tunnel between your dev environment and an existing operator pod in the cluster
which it will <strong>swap</strong></p><p>To launch the telepresence utility you can launch</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">make telepresence</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><blockquote><p>You need to install it before see : <a href="https://www.telepresence.io/" target="_blank" rel="noopener noreferrer">https://www.telepresence.io/</a></p></blockquote><p>If your cluster don&#x27;t have Internet access, you can change the telepresence image to use to one your cluster have access
exemple:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">TELEPRESENCE_REGISTRY=you-private-registry/datawire  make debug-telepresence-with-alias</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="configure-the-ide">Configure the IDE<a class="hash-link" href="#configure-the-ide" title="Direct link to heading">​</a></h4><p>Now we just need to configure the IDE :</p><p><img loading="lazy" src="/casskop/assets/images/ide_debug_configuration-8526080b8539923c9ccd9d8e3e2738ca.png" width="800" height="510"></p><p>and let&#x27;s the magic happened</p><p><img loading="lazy" src="/casskop/assets/images/ide_debug_action-03ad1d55c293740efc5e4f3773c2e809.png" width="800" height="672"></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="build-multi-casskop">Build Multi-CassKop<a class="hash-link" href="#build-multi-casskop" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_mojV" id="using-your-docker-environment">Using your docker environment<a class="hash-link" href="#using-your-docker-environment" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd $(git rev-parse --show-toplevel)/multi-casskop</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">make docker-build</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="run-multi-casskop">Run Multi-CassKop<a class="hash-link" href="#run-multi-casskop" title="Direct link to heading">​</a></h3><p>We can quickly setup a k3d cluster with casskop and multi-casskop to test a PR on multi-casskop. </p><ul><li>[Build your multi-casskop docker image]<!-- -->(#### Using your docker environment) which should print</li></ul><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo &quot;Generate zzz-deepcopy objects&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Generate zzz-deepcopy objects</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Successfully built bf57e90615bb</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Successfully tagged ghcr.io/cscetbon/multi-casskop:0.5.6-my-pr</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ul><li>Create a k3 cluster with 2 namespaces and install casskop</li></ul><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">k3d cluster create multi-casskop-qa</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd $(git rev-parse --show-toplevel)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl  apply -f config/crd/bases/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl  create namespace cluster1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl  create namespace cluster2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">helm install casskop -n cluster1 oci://ghcr.io/cscetbon/casskop-helm --set debug.enabled=true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">helm install casskop -n cluster2 oci://ghcr.io/cscetbon/casskop-helm --set debug.enabled=true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubemcsa export --context=k3d-multi-casskop-qa casskop --as k8s-cluster2 -n cluster1 | k apply -n cluster1 -f -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ul><li>Update generated secret to use <code>server: https://kubernetes.default.svc/</code> in its config (We won&#x27;t need that method
anymore and will be able to create 2 different clusters when <a href="https://github.com/rancher/k3d/issues/101" target="_blank" rel="noopener noreferrer">https://github.com/rancher/k3d/issues/101</a> is solved)</li></ul><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl  get secrets -n cluster1 k8s-cluster2 -o json|jq -r &#x27;.data.config&#x27;|base64 -d|pbcopy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># set server to https://kubernetes.default.svc in the output, then copy it in the clipboard and run</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pbpaste|base64 -w10000|pbcopy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># You now have to edit the secret and replace config&#x27;s value by what you have in your clipboard</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ul><li>load the docker image you built in the first step into your k3d cluster</li></ul><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">k3d image import ghcr.io/cscetbon/multi-casskop:0.5.6-my-pr -c multi-casskop-qa</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">INFO[0000] Loading images into &#x27;multi-casskop-qa&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">INFO[0000] Starting k3d-tools node...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">INFO[0000] Saving 1 image(s) from runtime...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">INFO[0004] Importing images into nodes...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">INFO[0004] Importing images from tarball &#x27;/k3d/images/k3d-multi-casskop-qa-images-20200929124019.tar&#x27; into node &#x27;k3d-multi-casskop-qa-server-0&#x27;...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">INFO[0006] Removing the tarball(s) from image volume...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">INFO[0007] Removing k3d-tools node...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">INFO[0008] Deleted k3d-multi-casskop-qa-tools</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">INFO[0008] Successfully imported image(s)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">INFO[0008] DONE</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ul><li>Install multi-casskop using the image you just imported</li></ul><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">helm install multi-casskop oci://ghcr.io/cscetbon/multi-casskop-helm --set k8s.local=k3d-multi-casskop-qa \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --set k8s.remote={k8s-cluster2} --set image.tag=0.5.6-my-pr --set debug.enabled=true -n cluster1 \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --set image.pullPolicy=IfNotPresent</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="how-this-repository-was-initially-build">How this repository was initially build<a class="hash-link" href="#how-this-repository-was-initially-build" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="boilerplate-casskop">Boilerplate CassKop<a class="hash-link" href="#boilerplate-casskop" title="Direct link to heading">​</a></h3><p>We used the SDK to create the repository layout. This command is for memory ;) (or for applying sdk upgrades)</p><blockquote><p>You need to have first install the SDK.</p></blockquote><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#old version</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> operator-sdk new casskop --api-version=db.orange.com/v2 --kind=CassandraCluster</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#new version</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">operator-sdk new casskop --dep-manager=modules --repo=github.com.cscetbon/casskop --type=go</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Then you want to add managers:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Add a new API for the custom resource CassandraCluster</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ operator-sdk add api --api-version=db.orange.com/v2 --kind=CassandraCluster</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Add a new controller that watches for CassandraCluster</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ operator-sdk add controller --api-version=db.orange.com/v2 --kind=CassandraCluster</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="useful-infos-for-developers">Useful Infos for developers<a class="hash-link" href="#useful-infos-for-developers" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_mojV" id="parsing-yaml-from-string">Parsing Yaml from String<a class="hash-link" href="#parsing-yaml-from-string" title="Direct link to heading">​</a></h4><p>For parsing Yaml from string to Go Object we uses this library : <code>github.com/ghodss/yaml</code> because with the official one
not all fields of the yaml where correctly populated. I don&#x27;t know why..</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/cscetbon/casskop/edit/master/website/docs/8_contributing/1_developer_guide.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/casskop/docs/troubleshooting/gke_issues"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">GKE Issues</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/casskop/docs/contributing/release_guide"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Release guide</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#operator-sdk" class="table-of-contents__link toc-highlight">Operator SDK</a><ul><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#install-the-operator-sdk-cli" class="table-of-contents__link toc-highlight">Install the Operator SDK CLI</a></li><li><a href="#initial-setup" class="table-of-contents__link toc-highlight">Initial setup</a></li><li><a href="#local-kubernetes-setup" class="table-of-contents__link toc-highlight">Local kubernetes setup</a></li><li><a href="#build-casskop" class="table-of-contents__link toc-highlight">Build CassKop</a></li><li><a href="#run-casskop" class="table-of-contents__link toc-highlight">Run CassKop</a></li><li><a href="#run-unit-tests" class="table-of-contents__link toc-highlight">Run unit-tests</a></li><li><a href="#run-e2e-end-to-end-tests" class="table-of-contents__link toc-highlight">Run e2e end to end tests</a></li><li><a href="#run-kuttl-tests" class="table-of-contents__link toc-highlight">Run kuttl tests</a></li><li><a href="#debug-casskop-in-remote-in-a-kubernetes-cluster" class="table-of-contents__link toc-highlight">Debug CassKop in remote in a Kubernetes cluster</a></li><li><a href="#build-multi-casskop" class="table-of-contents__link toc-highlight">Build Multi-CassKop</a></li><li><a href="#run-multi-casskop" class="table-of-contents__link toc-highlight">Run Multi-CassKop</a></li></ul></li><li><a href="#how-this-repository-was-initially-build" class="table-of-contents__link toc-highlight">How this repository was initially build</a><ul><li><a href="#boilerplate-casskop" class="table-of-contents__link toc-highlight">Boilerplate CassKop</a></li><li><a href="#useful-infos-for-developers" class="table-of-contents__link toc-highlight">Useful Infos for developers</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Getting Started</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/casskop/docs/concepts/introduction">Documentation</a></li><li class="footer__item"><a href="https://github.com/cscetbon/casskop" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://casskop.slack.com" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a class="footer__link-item" href="/casskop/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Contact</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/cscetbon/casskop/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Feature request<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Orange, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/casskop/assets/js/runtime~main.a5dc286a.js"></script>
<script src="/casskop/assets/js/main.70a062b2.js"></script>
</body>
</html>